<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudiantes - Just Talk Academy</title>
    <link rel="stylesheet" href="../../public/css/gestion.css">
    <link rel="stylesheet" href="../../public/css/estudiantes.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="logo.png" alt="Logo Just Talk Academy" class="sidebar-logo">
                <h2>Just Talk</h2>
                <h2>Academy</h2>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="#" id="view-users-btn">Gestión de Usuarios</a></li>
                    <li class="active"><a href="#" id="view-students-btn">Estudiantes</a></li> 
                    <li><a href="#" id="view-cursos-btn">Cursos</a></li>
                    <li><a href="#" id="view-deudores-btn">Deudores</a></li>
                    <li class="logout-container"><button id="logout-btn" class="logout-btn" title="Cerrar sesión"><img src="../../public/MiLogOut.png" alt="Salir"/></button></li>
                </ul>
            </nav>
        </aside>

        <main class="content-area">
            <h1>Estudiantes</h1>

            <div style="margin:8px 0; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <label for="tasa-input" style="margin-right:6px; font-weight:600;">Valor del Dólar (BS → USD):</label>
                <input id="tasa-input" type="number" step="0.01" style="width:130px;" placeholder="0.00">
                <button id="tasa-save-btn">Guardar Tasa</button>
                <button id="tasa-hist-btn" title="Ver historial de tasas">Historial</button>
                <span id="tasa-msg" style="margin-left:8px;color:#2a7;display:none;"></span>
            </div>

            <!-- VIEW TOGGLE & ACTIONS -->
            <div style="display:flex; justify-content:space-between; align-items:center; margin: 20px 0; gap: 10px;">
                <div class="view-toggle" style="background:#eee; padding:4px; border-radius:8px; display:flex; gap:4px;">
                    <button id="view-cards-btn" class="active" style="border:none; padding:8px 14px; border-radius:6px; cursor:pointer; font-weight:600; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.1); font-size:18px;" title="Vista de Tarjetas">⊞</button>
                    <button id="view-list-btn" style="border:none; padding:8px 14px; border-radius:6px; cursor:pointer; font-weight:600; background:transparent; color:#666; font-size:18px;" title="Vista de Lista">☰</button>
                </div>
                
                <input type="text" id="search-grupos" placeholder="Buscar estudiantes o grupos..." style="flex:1; max-width:300px; padding:8px 12px; border:1px solid #ddd; border-radius:6px;">

                <button id="add-student-btn" class="primary-btn">+ Agregar Estudiante</button>
            </div>

            <!-- VIEWS CONTAINERS -->
            
            <!-- 1. CARDS VIEW -->
            <div id="grupos-cards" class="cards-container">
                <!-- Cards will be injected here -->
            </div>

            <!-- 2. LIST VIEW (Initially Hidden) -->
            <div id="all-students-list" style="display:none;">
                <!-- Full list will be injected here -->
            </div>

            <!-- 3. SINGLE GROUP VIEW (Initially Hidden) -->
            <div id="grupo-students" style="display: none;">
                <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                    <button id="back-to-groups" style="background:#95a5a6; color:white; border:none; padding:8px 16px; border-radius:6px; font-size:1em; cursor:pointer; font-weight:600; box-shadow:0 2px 4px rgba(0,0,0,0.1); transition:all 0.2s ease;">← Volver</button>
                    <h2 id="grupo-students-title" style="margin:0;">Estudiantes</h2>
                </div>
                <div class="user-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Edad</th>
                                <th>Último pago realizado</th>
                                <th style="text-align: center;">Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
                <p id="no-students-message" class="info-message" style="display: none;">No hay estudiantes en este grupo.</p>
            </div>

            <!-- MODALS -->

            <!-- TASA HISTORY MODAL -->
            <div id="tasa-hist-modal" class="modal" style="display:none;">
                <div class="modal-content large">
                    <span class="close-button" id="close-tasa-hist">&times;</span>
                    <h2>Historial de Tasas</h2>
                    <div style="max-height:400px; overflow:auto;">
                        <table style="width:100%; border-collapse:collapse;">
                            <thead>
                                <tr>
                                    <th style="text-align:left;padding:6px">Fecha</th>
                                    <th style="text-align:right;padding:6px">Tasa (USD → BS)</th>
                                </tr>
                            </thead>
                            <tbody id="tasa-hist-body">
                                <!-- History rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- STUDENT DETAILS MODAL -->
            <div id="student-details-modal" class="modal" style="display:none;">
                <div class="modal-content large">
                    <span class="close-button" id="close-student-details">&times;</span>
                    <h2 id="details-title">Detalle del Estudiante</h2>
                    <div id="details-body">
                        <!-- Details injected via JS -->
                    </div>
                </div>
            </div>

            <!-- ADD STUDENT MODAL -->
            <div id="add-student-modal" class="modal" style="display:none;">
                <div class="modal-content">
                    <span class="close-button" id="close-add-student">&times;</span>
                    <h2 id="student-modal-title">Agregar Estudiante</h2>
                    <form id="add-student-form" novalidate>
                        <div class="input-group">
                            <label>Nombres</label>
                            <input type="text" id="est-Nombres" required>
                        </div>
                        <div class="input-group">
                            <label>Apellidos</label>
                            <input type="text" id="est-Apellidos" required>
                        </div>
                        <div class="input-group">
                            <label>Cédula</label>
                            <input type="text" id="est-Cedula" required>
                        </div>
                        <div class="input-group">
                            <label>Fecha de Nacimiento</label>
                            <input type="date" id="est-Fecha_Nacimiento" required>
                        </div>
                        <div class="input-group">
                            <label>Teléfono</label>
                            <input type="text" id="est-Telefono">
                        </div>
                        <div class="input-group">
                            <label>Correo</label>
                            <input type="email" id="est-Correo">
                        </div>
                        <div class="input-group">
                            <label>Dirección</label>
                            <input type="text" id="est-Direccion">
                        </div>

                        <div id="representante-section" style="display:none; border-top:1px solid #ddd; padding-top:10px; margin-top:10px;">
                            <h3>Datos del representante (requerido si menor de edad)</h3>
                            <div class="input-group">
                                <label>Nombres</label>
                                <input type="text" id="rep-Nombres">
                            </div>
                            <div class="input-group">
                                <label>Apellidos</label>
                                <input type="text" id="rep-Apellidos">
                            </div>
                            <div class="input-group">
                                <label>Cédula</label>
                                <input type="text" id="rep-Cedula">
                            </div>
                            <div class="input-group">
                                <label>Parentesco</label>
                                <input type="text" id="rep-Parentesco">
                            </div>
                            <div class="input-group">
                                <label>Teléfono representante</label>
                                <input type="text" id="rep-Telefono">
                            </div>
                            <div class="input-group">
                                <label>Correo representante</label>
                                <input type="email" id="rep-Correo">
                            </div>
                        </div>

                        <div class="row-two" style="margin-top:10px;">
                                <div class="input-group">
                                    <label>Grupos (seleccione uno o más)</label>
                                    <input type="text" id="ins-grupo-autocomplete" placeholder="Buscar grupo..." autocomplete="off">
                                    <div id="ins-grupo-suggestions" class="suggestions" style="position:relative;"></div>
                                    <div id="ins-selected-grupos" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;"></div>
                                    <select id="ins-idGrupo" style="display:none;">
                                        <option value="">-- Seleccione un grupo --</option>
                                    </select>
                                </div>
                            <div class="input-group">
                                <label>Fecha de inscripción</label>
                                <input type="date" id="ins-Fecha_inscripcion" required />
                            </div>
                        </div>

                        <button type="submit">Guardar Estudiante</button>
                        <p id="add-student-error" class="error-message"></p>
                    </form>
                </div>
            </div>

        </main>
    </div>

    <script src="../../public/js/menu.js"></script>
    <script src="../../public/js/estudiantes.js"></script>
    <script src="../../public/js/cursosGrupos.js"></script>
    <script src="../../public/js/search-estudiantes.js"></script>
</body>
</html>