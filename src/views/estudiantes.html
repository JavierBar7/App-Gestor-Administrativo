<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudiantes - Just Talk Academy</title>
    <link rel="stylesheet" href="../../public/gestion.css">
    <link rel="stylesheet" href="../../public/estudiantes.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="logo.png" alt="Logo Just Talk Academy" class="sidebar-logo">
                <h2>Just Talk</h2>
                <h2>Academy</h2>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="#" id="view-users-btn">Gestión de Usuarios</a></li>
                    <li class="active"><a href="#" id="view-students-btn">Estudiantes</a></li> <li><a href="#" id="view-cursos-btn">Cursos</a></li>
                    <li><a href="#" id="view-deudores-btn">Deudores</a></li>
                    <li class="logout-container"><button id="logout-btn" class="logout-btn" title="Cerrar sesión"><img src="../../public/MiLogOut.png" alt="Salir"/></button></li>
                </ul>
            </nav>
        </aside>

        <main class="content-area">
            <h1>Estudiantes</h1>

            <div style="margin:8px 0; display:flex; gap:8px; align-items:center;">
                <label for="tasa-input" style="margin-right:6px; font-weight:600;">Valor del Dólar (BS → USD):</label>
                <input id="tasa-input" type="number" step="0.0001" style="width:130px;" placeholder="0.00">
                <button id="tasa-save-btn">Guardar Tasa</button>
                <button id="tasa-hist-btn" title="Ver historial de tasas">Historial</button>
                <span id="tasa-msg" style="margin-left:8px;color:#2a7;display:none;"></span>
            </div>

            <div id="tasa-hist-modal" class="modal" style="display:none;">
                <div class="modal-content large">
                    <span class="close-button" id="close-tasa-hist">&times;</span>
                    <h2>Historial de Tasas</h2>
                    <div style="max-height:400px; overflow:auto;">
                        <table style="width:100%; border-collapse:collapse;">
                            <thead><tr><th style="text-align:left;padding:6px">Fecha</th><th style="text-align:right;padding:6px">Tasa (USD → BS)</th></tr></thead>
                            <tbody id="tasa-hist-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <button id="add-student-btn">Agregar Estudiante</button>
            </div>

            <div id="grupos-cards" class="cards-container" style="display: flex; flex-wrap: wrap; gap: 12px;">
                </div>

            <div id="grupo-students" style="margin-top:20px; display:none;">
                <h2 id="grupo-students-title">Estudiantes</h2>
                <button id="back-to-groups">Volver a Grupos</button>
                <div class="user-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Edad</th>
                                <th>Último pago realizado</th>
                                <th>Deuda pendiente</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body"></tbody>
                    </table>
                    <p id="no-students-message" class="info-message" style="display: none;">No hay estudiantes en este grupo.</p>
                </div>
            </div>

        <div id="student-details-modal" class="modal" style="display:none;">
            <div class="modal-content large">
                <span class="close-button" id="close-student-details">&times;</span>
                <h2 id="details-title">Detalle del Estudiante</h2>
                <div id="details-body">
                    <section>
                        <h3>Datos personales</h3>
                        <div style="display:flex; gap:24px; align-items:flex-start;">
                            <div style="flex:1; min-width:200px;">
                                <div style="margin-bottom:8px;"><strong>Nombre:</strong> <span id="det-nombre"></span></div>
                                <div style="margin-bottom:8px;"><strong>Cédula:</strong> <span id="det-cedula"></span></div>
                                <div style="margin-bottom:8px;"><strong>Fecha de Nacimiento:</strong> <span id="det-fecha-nac"></span></div>
                            </div>
                            <div style="flex:1; min-width:200px;">
                                <div style="margin-bottom:8px;"><strong>Teléfono:</strong> <span id="det-telefono"></span></div>
                                <div style="margin-bottom:8px;"><strong>Correo:</strong> <span id="det-correo"></span></div>
                                <div style="margin-bottom:8px;"><strong>Dirección:</strong> <span id="det-direccion"></span></div>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>Representante</h3>
                        <div id="det-representante">No posee representante registrado.</div>
                    </section>

                    <section>
                        <h3>Pagos</h3>
                        <table id="det-pagos-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Mes</th>
                                    <th>Referencia</th>
                                    <th>Grupo</th>
                                    <th>Observación</th>
                                    <th>Monto Bs</th>
                                    <th>Monto USD</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>

                    <section>
                        <h3>Deudas</h3>
                        <table id="det-deudas-table">
                            <thead>
                                <tr>
                                    <th>Concepto</th>
                                    <th>Monto USD</th>
                                    <th>Fecha Emisión</th>
                                    <th>Vencimiento</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>

                    <section>
                        <h3>Historial de Grupos</h3>
                        <table id="det-grupos-table">
                            <thead><tr><th>Fecha inscripción</th><th>Grupo</th><th>Curso</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </section>
                </div>
            </div>
        </div>
        </main>
    </div>

    <div id="add-student-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" id="close-add-student">&times;</span>
            <h2 id="student-modal-title">Agregar Estudiante</h2>
            <form id="add-student-form">
                <div class="input-group">
                    <label>Nombres</label>
                    <input type="text" id="est-Nombres" required>
                </div>
                <div class="input-group">
                    <label>Apellidos</label>
                    <input type="text" id="est-Apellidos" required>
                </div>
                <div class="input-group">
                    <label>Cédula</label>
                    <input type="text" id="est-Cedula" required>
                </div>
                <div class="input-group">
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="est-Fecha_Nacimiento" required>
                </div>
                <div class="input-group">
                    <label>Teléfono</label>
                    <input type="text" id="est-Telefono">
                </div>
                <div class="input-group">
                    <label>Correo</label>
                    <input type="email" id="est-Correo">
                </div>
                <div class="input-group">
                    <label>Dirección</label>
                    <input type="text" id="est-Direccion">
                </div>

                <div id="representante-section" style="display:none; border-top:1px solid #ddd; padding-top:10px; margin-top:10px;">
                    <h3>Datos del representante (requerido si menor de edad)</h3>
                    <div class="input-group">
                        <label>Nombres</label>
                        <input type="text" id="rep-Nombres">
                    </div>
                    <div class="input-group">
                        <label>Apellidos</label>
                        <input type="text" id="rep-Apellidos">
                    </div>
                    <div class="input-group">
                        <label>Cédula</label>
                        <input type="text" id="rep-Cedula">
                    </div>
                    <div class="input-group">
                        <label>Parentesco</label>
                        <input type="text" id="rep-Parentesco">
                    </div>
                    <div class="input-group">
                        <label>Teléfono representante</label>
                        <input type="text" id="rep-Telefono">
                    </div>
                    <div class="input-group">
                        <label>Correo representante</label>
                        <input type="email" id="rep-Correo">
                    </div>
                </div>

                <div class="row-two" style="margin-top:10px;">
                        <div class="input-group">
                            <label>Grupos (seleccione uno o más)</label>
                            <input type="text" id="ins-grupo-autocomplete" placeholder="Buscar grupo..." autocomplete="off">
                            <div id="ins-grupo-suggestions" class="suggestions" style="position:relative;"></div>
                            <div id="ins-selected-grupos" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;"></div>
                            <!-- Hidden fallback select (kept for backwards compatibility) -->
                            <select id="ins-idGrupo" style="display:none;">
                                <option value="">-- Seleccione un grupo --</option>
                            </select>
                        </div>
                    <div class="input-group">
                        <label>Fecha de inscripción</label>
            </div>

            <!-- Historial de tasas modal -->
            <div id="tasa-hist-modal" class="modal" style="display:none;">
                <div class="modal-content large">
                    <span class="close-button" id="close-tasa-hist">&times;</span>
                    <h2>Historial de Tasas</h2>
                    <div style="max-height:400px; overflow:auto;">
                        <table style="width:100%; border-collapse:collapse;">
                            <thead><tr><th style="text-align:left;padding:6px">Fecha</th><th style="text-align:right;padding:6px">Tasa (USD → BS)</th></tr></thead>
                            <tbody id="tasa-hist-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div style="margin: 12px 0;">
                <button id="add-student-btn">Agregar Estudiante</button>
            </div>

            <!-- Grupos cards view -->
            <div id="grupos-cards" class="cards-container" style="display: flex; flex-wrap: wrap; gap: 12px;">
                <!-- cards rendered here -->
            </div>

            <!-- Students list for selected group (hidden until a group is selected) -->
            <div id="grupo-students" style="margin-top:20px; display:none;">
                <h2 id="grupo-students-title">Estudiantes</h2>
                <button id="back-to-groups">Volver a Grupos</button>
                <div class="user-table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Edad</th>
                                <th>Último pago realizado</th>
                                <th>Deuda pendiente</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body"></tbody>
                    </table>
                    <p id="no-students-message" class="info-message" style="display: none;">No hay estudiantes en este grupo.</p>
                </div>
            </div>

        <!-- Student details modal -->
        <div id="student-details-modal" class="modal" style="display:none;">
            <div class="modal-content large">
                <span class="close-button" id="close-student-details">&times;</span>
                <h2 id="details-title">Detalle del Estudiante</h2>
                <div id="details-body">
                    <section>
                        <h3>Datos personales</h3>
                        <div style="display:flex; gap:24px; align-items:flex-start;">
                            <div style="flex:1; min-width:200px;">
                                <div style="margin-bottom:8px;"><strong>Nombre:</strong> <span id="det-nombre"></span></div>
                                <div style="margin-bottom:8px;"><strong>Cédula:</strong> <span id="det-cedula"></span></div>
                                <div style="margin-bottom:8px;"><strong>Fecha de Nacimiento:</strong> <span id="det-fecha-nac"></span></div>
                            </div>
                            <div style="flex:1; min-width:200px;">
                                <div style="margin-bottom:8px;"><strong>Teléfono:</strong> <span id="det-telefono"></span></div>
                                <div style="margin-bottom:8px;"><strong>Correo:</strong> <span id="det-correo"></span></div>
                                <div style="margin-bottom:8px;"><strong>Dirección:</strong> <span id="det-direccion"></span></div>
                            </div>
                        </div>
                    </section>

                    <section>
                        <h3>Representante</h3>
                        <div id="det-representante">No posee representante registrado.</div>
                    </section>

                    <section>
                        <h3>Pagos</h3>
                        <table id="det-pagos-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Mes</th>
                                    <th>Referencia</th>
                                    <th>Grupo</th>
                                    <th>Observación</th>
                                    <th>Monto Bs</th>
                                    <th>Monto USD</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>

                    <section>
                        <h3>Deudas</h3>
                        <table id="det-deudas-table">
                            <thead>
                                <tr>
                                    <th>Concepto</th>
                                    <th>Monto USD</th>
                                    <th>Fecha Emisión</th>
                                    <th>Vencimiento</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </section>

                    <section>
                        <h3>Historial de Grupos</h3>
                        <table id="det-grupos-table">
                            <thead><tr><th>Fecha inscripción</th><th>Grupo</th><th>Curso</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </section>
                </div>
            </div>
        </div>
        </main>
    </div>

    <div id="add-student-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <span class="close-button" id="close-add-student">&times;</span>
            <h2 id="student-modal-title">Agregar Estudiante</h2>
            <form id="add-student-form">
                <div class="input-group">
                    <label>Nombres</label>
                    <input type="text" id="est-Nombres" required>
                </div>
                <div class="input-group">
                    <label>Apellidos</label>
                    <input type="text" id="est-Apellidos" required>
                </div>
                <div class="input-group">
                    <label>Cédula</label>
                    <input type="text" id="est-Cedula" required>
                </div>
                <div class="input-group">
                    <label>Fecha de Nacimiento</label>
                    <input type="date" id="est-Fecha_Nacimiento" required>
                </div>
                <div class="input-group">
                    <label>Teléfono</label>
                    <input type="text" id="est-Telefono">
                </div>
                <div class="input-group">
                    <label>Correo</label>
                    <input type="email" id="est-Correo">
                </div>
                <div class="input-group">
                    <label>Dirección</label>
                    <input type="text" id="est-Direccion">
                </div>

                <div id="representante-section" style="display:none; border-top:1px solid #ddd; padding-top:10px; margin-top:10px;">
                    <h3>Datos del representante (requerido si menor de edad)</h3>
                    <div class="input-group">
                        <label>Nombres</label>
                        <input type="text" id="rep-Nombres">
                    </div>
                    <div class="input-group">
                        <label>Apellidos</label>
                        <input type="text" id="rep-Apellidos">
                    </div>
                    <div class="input-group">
                        <label>Cédula</label>
                        <input type="text" id="rep-Cedula">
                    </div>
                    <div class="input-group">
                        <label>Parentesco</label>
                        <input type="text" id="rep-Parentesco">
                    </div>
                    <div class="input-group">
                        <label>Teléfono representante</label>
                        <input type="text" id="rep-Telefono">
                    </div>
                    <div class="input-group">
                        <label>Correo representante</label>
                        <input type="email" id="rep-Correo">
                    </div>
                </div>

                <div class="row-two" style="margin-top:10px;">
                        <div class="input-group">
                            <label>Grupos (seleccione uno o más)</label>
                            <input type="text" id="ins-grupo-autocomplete" placeholder="Buscar grupo..." autocomplete="off">
                            <div id="ins-grupo-suggestions" class="suggestions" style="position:relative;"></div>
                            <div id="ins-selected-grupos" style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;"></div>
                            <select id="ins-idGrupo" style="display:none;">
                                <option value="">-- Seleccione un grupo --</option>
                            </select>
                        </div>
                    <div class="input-group">
                        <label>Fecha de inscripción</label>
                        <input type="date" id="ins-Fecha_inscripcion" />
                    </div>
                </div>


                <button type="submit">Guardar Estudiante</button>
                <p id="add-student-error" class="error-message"></p>
            </form>
        </div>
    </div>

    <script src="../../public/js/menu.js"></script>
    <script src="../../public/js/estudiantes.js"></script>
    <script src="../../public/js/cursosGrupos.js"></script>
</body>
</html>